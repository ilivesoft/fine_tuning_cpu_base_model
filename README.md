# í”„ë¡œì íŠ¸ êµ¬ì¡°

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
llama_finetune_project/
â”œâ”€â”€ ğŸ“„ config.py                    # ì„¤ì • íŒŒì¼ (ëª¨ë¸, í›ˆë ¨, ì¶”ë¡  ì„¤ì •)
â”œâ”€â”€ ğŸ“„ data_loader.py               # ë°ì´í„° ë¡œë”© ë° ì „ì²˜ë¦¬
â”œâ”€â”€ ğŸ“„ model_manager.py             # ëª¨ë¸ ë¡œë”© ë° ê´€ë¦¬
â”œâ”€â”€ ğŸ“„ trainer.py                   # í›ˆë ¨ ê´€ë ¨ ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ ğŸ“„ inference_manager.py         # ì¶”ë¡  ë° í…ìŠ¤íŠ¸ ìƒì„±
â”œâ”€â”€ ğŸ“„ utils.py                     # ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”œâ”€â”€ ğŸ“„ main_train.py                # ë©”ì¸ í›ˆë ¨ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ ğŸ“„ main_inference.py            # ë©”ì¸ ì¶”ë¡  ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ ğŸ“„ run_scripts.sh               # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ëª¨ìŒ
â”œâ”€â”€ ğŸ“„ requirements.txt             # Python íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
â”œâ”€â”€ ğŸ“„ civil_law_qa_dataset.csv     # Q/A ë°ì´í„°ì…‹ (ë³„ë„ ìƒì„± í•„ìš”)
â”œâ”€â”€ ğŸ“„ README.md                    # í”„ë¡œì íŠ¸ ì„¤ëª…ì„œ
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md         # ì´ íŒŒì¼
â””â”€â”€ ğŸ“ fine_tuned_model/            # í›ˆë ¨ëœ ëª¨ë¸ ì €ì¥ ë””ë ‰í† ë¦¬ (í›ˆë ¨ í›„ ìƒì„±)
    â”œâ”€â”€ adapter_config.json
    â”œâ”€â”€ adapter_model.bin
    â”œâ”€â”€ tokenizer.json
    â”œâ”€â”€ tokenizer_config.json
    â””â”€â”€ training_stats.json
```

## ğŸ“‹ íŒŒì¼ë³„ ê¸°ëŠ¥ ì„¤ëª…

### ğŸ”§ í•µì‹¬ ëª¨ë“ˆ

#### `config.py`
- **ì—­í• **: ì „ì—­ ì„¤ì • ê´€ë¦¬
- **ì£¼ìš” í´ë˜ìŠ¤**:
  - `ModelConfig`: ëª¨ë¸ ê´€ë ¨ ì„¤ì •
  - `LoRAConfig`: LoRA fine-tuning ì„¤ì •
  - `TrainingConfig`: í›ˆë ¨ íŒŒë¼ë¯¸í„°
  - `InferenceConfig`: ì¶”ë¡  ì„¤ì •
  - `SystemConfig`: ì‹œìŠ¤í…œ í™˜ê²½ ì„¤ì •
- **ì£¼ìš” í•¨ìˆ˜**:
  - `format_prompt()`: í”„ë¡¬í”„íŠ¸ í¬ë§·íŒ…
  - `get_system_prompt()`: ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±

#### `data_loader.py`
- **ì—­í• **: ë°ì´í„° ë¡œë”© ë° ì „ì²˜ë¦¬
- **ì£¼ìš” í´ë˜ìŠ¤**:
  - `DataLoader`: CSV ë°ì´í„° ë¡œë”© ë° í† í¬ë‚˜ì´ì§•
- **ì£¼ìš” ê¸°ëŠ¥**:
  - CSV íŒŒì¼ ì½ê¸° ë° ê²€ì¦
  - í”„ë¡¬í”„íŠ¸ í¬ë§·íŒ…
  - í† í¬ë‚˜ì´ì§• ë° Dataset ìƒì„±
  - ë°ì´í„° í†µê³„ ì •ë³´ ì œê³µ

#### `model_manager.py`
- **ì—­í• **: ëª¨ë¸ ë¡œë”© ë° ê´€ë¦¬
- **ì£¼ìš” í´ë˜ìŠ¤**:
  - `ModelManager`: í›ˆë ¨ìš© ëª¨ë¸ ê´€ë¦¬
  - `InferenceModelManager`: ì¶”ë¡ ìš© ëª¨ë¸ ê´€ë¦¬
- **ì£¼ìš” ê¸°ëŠ¥**:
  - í† í¬ë‚˜ì´ì € ë° ëª¨ë¸ ë¡œë”©
  - LoRA ì„¤ì • ë° ì ìš©
  - Fine-tuned ëª¨ë¸ ë¡œë”©
  - GPU ë©”ëª¨ë¦¬ ê´€ë¦¬

#### `trainer.py`
- **ì—­í• **: ëª¨ë¸ í›ˆë ¨ ê´€ë¦¬
- **ì£¼ìš” í´ë˜ìŠ¤**:
  - `CustomTrainer`: ì»¤ìŠ¤í…€ íŠ¸ë ˆì´ë„ˆ
  - `TrainingManager`: í›ˆë ¨ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬
- **ì£¼ìš” ê¸°ëŠ¥**:
  - í›ˆë ¨ ì¸ì ì„¤ì •
  - ë°ì´í„° ì½œë ˆì´í„° ìƒì„±
  - í›ˆë ¨ ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§
  - ëª¨ë¸ ì €ì¥

#### `inference_manager.py`
- **ì—­í• **: ì¶”ë¡  ë° í…ìŠ¤íŠ¸ ìƒì„±
- **ì£¼ìš” í´ë˜ìŠ¤**:
  - `InferenceManager`: ì¶”ë¡  ê´€ë¦¬
  - `ChatBot`: ëŒ€í™”í˜• ì±—ë´‡
- **ì£¼ìš” ê¸°ëŠ¥**:
  - í…ìŠ¤íŠ¸ ìƒì„±
  - ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤
  - ë°°ì¹˜ ì¶”ë¡ 
  - ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬

#### `utils.py`
- **ì—­í• **: ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ë¡œê¹… ì„¤ì •
  - ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸
  - GPU ì •ë³´ ë° ë©”ëª¨ë¦¬ ê´€ë¦¬
  - íŒŒì¼ ì…ì¶œë ¥ ìœ í‹¸ë¦¬í‹°
  - ì§„í–‰ ìƒí™© ì¶”ì 

### ğŸš€ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

#### `main_train.py`
- **ì—­í• **: ë©”ì¸ í›ˆë ¨ ìŠ¤í¬ë¦½íŠ¸
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ëª…ë ¹í–‰ ì¸ì ì²˜ë¦¬
  - ì „ì²´ í›ˆë ¨ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
  - í™˜ê²½ ì„¤ì • ë° ê²€ì¦
  - í›ˆë ¨ í†µê³„ ì €ì¥
- **ì‚¬ìš©ë²•**:
  ```bash
  python3 main_train.py --csv_path data.csv --output_dir ./model
  ```

#### `main_inference.py`
- **ì—­í• **: ë©”ì¸ ì¶”ë¡  ìŠ¤í¬ë¦½íŠ¸
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ë‹¤ì–‘í•œ ì¶”ë¡  ëª¨ë“œ ì§€ì›
  - ëŒ€í™”í˜•/ë‹¨ì¼ì§ˆë¬¸/ë°°ì¹˜ ì²˜ë¦¬
  - ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
  - ê²°ê³¼ ì €ì¥
- **ì‚¬ìš©ë²•**:
  ```bash
  python3 main_inference.py --model_path ./model --interactive
  ```

#### `run_scripts.sh`
- **ì—­í• **: í†µí•© ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ë‹¤ì–‘í•œ ì‹¤í–‰ ëª¨ë“œ ì œê³µ
  - ì‹œìŠ¤í…œ ì ê²€
  - ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
  - ì‚¬ìš©ì ì¹œí™”ì  ì¸í„°í˜ì´ìŠ¤
- **ì‚¬ìš©ë²•**:
  ```bash
  ./run_scripts.sh train    # í›ˆë ¨ ì‹¤í–‰
  ./run_scripts.sh chat     # ëŒ€í™”í˜• ì¶”ë¡ 
  ./run_scripts.sh full     # ì „ì²´ íŒŒì´í”„ë¼ì¸
  ```

## ğŸ”„ ì‹¤í–‰ í”Œë¡œìš°

### í›ˆë ¨ í”Œë¡œìš°
```mermaid
graph TD
    A[main_train.py] --> B[config.py ì„¤ì • ë¡œë“œ]
    B --> C[utils.py ì‹œìŠ¤í…œ ê²€ì¦]
    C --> D[model_manager.py ëª¨ë¸ ë¡œë“œ]
    D --> E[data_loader.py ë°ì´í„° ì²˜ë¦¬]
    E --> F[trainer.py í›ˆë ¨ ì‹¤í–‰]
    F --> G[ëª¨ë¸ ì €ì¥]
```

### ì¶”ë¡  í”Œë¡œìš°
```mermaid
graph TD
    A[main_inference.py] --> B[model_manager.py Fine-tuned ëª¨ë¸ ë¡œë“œ]
    B --> C[inference_manager.py ì¶”ë¡  ë§¤ë‹ˆì € ìƒì„±]
    C --> D{ì¶”ë¡  ëª¨ë“œ}
    D -->|ëŒ€í™”í˜•| E[ChatBot ì‹¤í–‰]
    D -->|ë‹¨ì¼ì§ˆë¬¸| F[ë‹¨ì¼ ì‘ë‹µ ìƒì„±]
    D -->|ë²¤ì¹˜ë§ˆí¬| G[ì„±ëŠ¥ í…ŒìŠ¤íŠ¸]
    D -->|ë°°ì¹˜| H[ë‹¤ì¤‘ ì§ˆë¬¸ ì²˜ë¦¬]
```

## âš™ï¸ ì„¤ì • ê´€ë¦¬

### ì£¼ìš” ì„¤ì • í•­ëª©

#### ëª¨ë¸ ì„¤ì • (`ModelConfig`)
- `model_name`: ë² ì´ìŠ¤ ëª¨ë¸ ì´ë¦„
- `max_length`: ìµœëŒ€ ì‹œí€€ìŠ¤ ê¸¸ì´
- `torch_dtype`: ëª¨ë¸ ë°ì´í„° íƒ€ì…
- `load_in_8bit`: 8bit ì–‘ìí™” ì‚¬ìš©

#### LoRA ì„¤ì • (`LoRAConfig`)
- `r`: LoRA rank (16)
- `lora_alpha`: ìŠ¤ì¼€ì¼ë§ íŒ©í„° (32)
- `lora_dropout`: ë“œë¡­ì•„ì›ƒ ë¹„ìœ¨ (0.1)
- `target_modules`: íƒ€ê²Ÿ ëª¨ë“ˆ ëª©ë¡

#### í›ˆë ¨ ì„¤ì • (`TrainingConfig`)
- `batch_size`: ë°°ì¹˜ í¬ê¸° (4)
- `gradient_accumulation_steps`: ê·¸ë˜ë””ì–¸íŠ¸ ëˆ„ì  (4)
- `learning_rate`: í•™ìŠµë¥  (2e-4)
- `num_train_epochs`: ì—í­ ìˆ˜ (3)

## ğŸ¯ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### 1. ê¸°ë³¸ í›ˆë ¨ ë° ì¶”ë¡ 
```bash
# 1. ì‹œìŠ¤í…œ í™•ì¸
./run_scripts.sh check_system

# 2. CSV íŒŒì¼ í™•ì¸
./run_scripts.sh check_csv

# 3. í›ˆë ¨ ì‹¤í–‰
./run_scripts.sh train

# 4. ëŒ€í™”í˜• ì¶”ë¡ 
./run_scripts.sh chat
```

### 2. ì»¤ìŠ¤í…€ ì„¤ì •ìœ¼ë¡œ í›ˆë ¨
```bash
python3 main_train.py \
    --csv_path my_data.csv \
    --output_dir ./custom_model \
    --batch_size 2 \
    --epochs 5 \
    --learning_rate 1e-4
```

### 3. ë‹¤ì–‘í•œ ì¶”ë¡  ëª¨ë“œ
```bash
# ë‹¨ì¼ ì§ˆë¬¸
python3 main_inference.py \
    --model_path ./fine_tuned_model \
    --question "ì „ì„¸ê¶Œì´ë€ ë¬´ì—‡ì¸ê°€ìš”?"

# íŒŒì¼ì˜ ì—¬ëŸ¬ ì§ˆë¬¸ ì²˜ë¦¬
python3 main_inference.py \
    --model_path ./fine_tuned_model \
    --questions_file questions.txt \
    --output_file results.md

# ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
python3 main_inference.py \
    --model_path ./fine_tuned_model \
    --benchmark
```

## ğŸ” ëª¨ë‹ˆí„°ë§ ë° ë””ë²„ê¹…

### ë¡œê·¸ íŒŒì¼
- `training_YYYYMMDD_HHMMSS.log`: í›ˆë ¨ ë¡œê·¸
- `inference_YYYYMMDD_HHMMSS.log`: ì¶”ë¡  ë¡œê·¸

### ì €ì¥ë˜ëŠ” íŒŒì¼
- `training_stats.json`: í›ˆë ¨ í†µê³„
- `adapter_config.json`: LoRA ì„¤ì •
- `adapter_model.bin`: Fine-tuned ê°€ì¤‘ì¹˜

### GPU ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§
```bash
# ì‹¤ì‹œê°„ GPU ëª¨ë‹ˆí„°ë§
watch -n 1 nvidia-smi

# Pythonì—ì„œ ë©”ëª¨ë¦¬ í™•ì¸
python3 -c "
from model_manager import check_gpu_memory
check_gpu_memory()
"
```

## ğŸ› ï¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•

### ìƒˆë¡œìš´ ì„¤ì • ì¶”ê°€
1. `config.py`ì— ìƒˆë¡œìš´ ì„¤ì • í´ë˜ìŠ¤ ì¶”ê°€
2. ê´€ë ¨ ëª¨ë“ˆì—ì„œ ì„¤ì • ì‚¬ìš©
3. ëª…ë ¹í–‰ ì¸ì ì¶”ê°€ (í•„ìš”ì‹œ)

### ìƒˆë¡œìš´ ë°ì´í„° í¬ë§· ì§€ì›
1. `data_loader.py`ì˜ `DataLoader` í´ë˜ìŠ¤ í™•ì¥
2. ìƒˆë¡œìš´ ë¡œë”© í•¨ìˆ˜ ì¶”ê°€
3. í¬ë§· ê²€ì¦ ë¡œì§ ì¶”ê°€

### ìƒˆë¡œìš´ ì¶”ë¡  ëª¨ë“œ ì¶”ê°€
1. `inference_manager.py`ì— ìƒˆë¡œìš´ ë©”ì„œë“œ ì¶”ê°€
2. `main_inference.py`ì— ëª…ë ¹í–‰ ì˜µì…˜ ì¶”ê°€
3. `run_scripts.sh`ì— ìƒˆë¡œìš´ ëª…ë ¹ ì¶”ê°€

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ë¦¬ ìµœì í™”
- 8bit ì–‘ìí™” (`load_in_8bit=True`)
- ê·¸ë˜ë””ì–¸íŠ¸ ì²´í¬í¬ì¸íŒ…
- ë°°ì¹˜ í¬ê¸° ì¡°ì •
- ì‹œí€€ìŠ¤ ê¸¸ì´ ì œí•œ

### ì†ë„ ìµœì í™”
- FP16 ì‚¬ìš©
- íš¨ìœ¨ì ì¸ ë°ì´í„° ë¡œë”©
- GPU ë©”ëª¨ë¦¬ ê´€ë¦¬
- ë¶ˆí•„ìš”í•œ ë¡œê·¸ ì œê±°

ì´ êµ¬ì¡°ëŠ” RTX 4060 8GB í™˜ê²½ì—ì„œ ìµœì í™”ë˜ì–´ ìˆìœ¼ë©°, ê° ëª¨ë“ˆì´ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•˜ë©´ì„œë„ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.